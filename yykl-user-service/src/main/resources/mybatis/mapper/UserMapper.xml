<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 注意namespace需与UserMapper接口的全类名一致 -->
<mapper namespace="com.yykl.user.mapper.UserMapper">

    <!-- 1. 根据用户名查询用户（包含基本信息） -->
    <select id="selectByUsername" parameterType="java.lang.String" resultType="com.yykl.user.model.entity.User">
        SELECT
        id,
        username,
        password,
        status,
        create_time,
        update_time
        FROM
        user
        WHERE
        username = #{username}
        AND status = 1  <!-- 假设1表示用户状态正常 -->
    </select>

    <!-- 2. 根据用户ID查询角色列表 -->
    <select id="selectRolesByUserId" parameterType="java.lang.Long" resultType="com.yykl.user.model.entity.Role">
        SELECT
            r.id,
            r.role_name,
            r.description
        FROM
            role r
                INNER JOIN user_role ur ON r.id = ur.role_id
        WHERE
            ur.user_id = #{userId}
    </select>

    <!-- 3. 根据用户ID查询权限列表 -->
    <select id="selectPermissionsByUserId" parameterType="java.lang.Long" resultType="com.yykl.user.model.entity.Permission">
        SELECT
        p.id,
        p.permission_name,
        p.url,
        p.method
        FROM
        permission p
        INNER JOIN role_permission rp ON p.id = rp.permission_id
        INNER JOIN user_role ur ON rp.role_id = ur.role_id
        WHERE
        ur.user_id = #{userId}
        GROUP BY
        p.id  <!-- 去重，避免同一权限被多次查询 -->
    </select>

</mapper>